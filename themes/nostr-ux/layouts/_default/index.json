{{- $pages := where .Site.RegularPages "Type" "in" (slice "patterns" "resources" "page") -}}
{{- $searchData := slice -}}
{{- range $pages -}}
  {{- $content := .Plain | htmlUnescape -}}
  {{- $content = replaceRE "[\\n\\r]+" " " $content -}}
  {{- $content = replaceRE "\\s+" " " $content -}}
  {{- $tags := slice -}}
  {{- with .Params.patternNumber -}}
    {{- $tags = $tags | append (printf "Pattern %v" .) -}}
  {{- end -}}
  {{- with .Params.tags -}}
    {{- $tags = $tags | append . -}}
  {{- end -}}
  {{- $searchData = $searchData | append (dict
    "url" .RelPermalink
    "title" .Title
    "content" $content
    "tags" (delimit $tags " ")
  ) -}}
{{- end -}}
{{- $searchData | jsonify -}}
